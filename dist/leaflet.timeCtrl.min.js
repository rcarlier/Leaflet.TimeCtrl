L.TimeCtrl=L.LayerGroup.extend({initialize:function(t,i){this.defaultOptions={text:{title:null,exact:"Exact",inter:"Beetween"},circle:{mini:6,maxi:12,color:"#FF0000",opacity:.5},data:{year:"year",lat:"lat",lng:"lng",value:"value"}},this._opt=L.Util.extend({},this.defaultOptions,i),this._validateOptions(),this.bounds=null,this.yearSliderMini=null,this.yearSliderMaxi=null,this.timeControl=null,this.minYear=1/0,this.maxYear=-1/0,this.count=0,this.data=t,this._opt.data.mini=1/0,this._opt.data.maxi=-1/0,this.data.forEach(t=>{this.minYear=Math.min(this.minYear,t[this._opt.data.year]),this.maxYear=Math.max(this.maxYear,t[this._opt.data.year]),this._opt.data.mini=Math.min(this._opt.data.mini,t[this._opt.data.value]),this._opt.data.maxi=Math.max(this._opt.data.mini,t[this._opt.data.value])}),console.table(this._opt.data),this.circleData=[],this._map=map,this._createControl(),this._createCircles(),this._updateCircles()},_validateType:function(t,i,e){typeof this._opt[t][i]!==e&&(console.warn(t+`.${i} option needs to be a ${e} ; default value applyed.`),this._opt[t][i]=this.defaultOptions[t][i])},_validateOptions:function(){this._validateType("text","title","string"),this._validateType("text","exact","string"),this._validateType("text","inter","string"),this._validateType("circle","mini","number"),this._validateType("circle","maxi","number"),this._validateType("circle","color","string"),this._validateType("circle","opacity","number"),this._validateType("data","year","string"),this._validateType("data","lat","string"),this._validateType("data","lng","string"),this._validateType("data","value","string")},_createCircles:function(){this.bounds=L.latLngBounds(),this.data.forEach(t=>{var i,e=this._opt.data.mini,a=this._opt.data.maxi,r=this._opt.circle.mini,l=this._opt.circle.maxi,n=t[this._opt.data.value],n=Math.log1p(9*((n-e)/(a-e))),a=L.circleMarker([t[this._opt.data.lat],t[this._opt.data.lng]],{color:this._opt.circle.color,opacity:this._opt.circle.opacity,fillColor:this._opt.circle.fillColor,fillOpacity:this._opt.circle.fillOpacity,weight:this._opt.circle.weight,radius:r+(l-r)*n});let s="";for(i in t)s+="<b>"+i+":</b> "+t[i]+"<br>";a.bindPopup(s),this.circleData.push({circle:a,data:t}),this.bounds.extend(a.getLatLng())}),map.fitBounds(this.bounds)},_createControl:function(){this.timeControl=L.control({position:"bottomright"}),this.timeControl.onAdd=()=>{var t=L.DomUtil.create("div","timeCtrl"),i=this._opt.text.title||"Significant Earthquakes",e=L.DomUtil.create("div"),i=(e.innerHTML=`
                <p class="timeCtrlTitle">${i}</p>
                <p id="yearLabel" class="timeCtrlYear"</p>
            `,t.appendChild(e),L.DomUtil.create("div")),e=(i.innerHTML=`
            <div id="yearMini" class="timeCtrlYearSlider">
                <input 
                    id="yearSliderMini"
                    type="range"
                    min="${this.minYear}"
                    max="${this.maxYear}"
                    step="1"
                    value="${this.minYear}"
                    class="timeCtrlSlider"
                />
                <output id="yearOutputMini" class="timeCtrlOutput">0000</output>
            </div>
            `,this.yearSliderMini=i.querySelector("#yearSliderMini"),t.appendChild(i),L.DomUtil.create("div")),i=(e.innerHTML+=`
            <div id="yearMaxi" class="timeCtrlYearSlider">
                <input 
                    id="yearSliderMaxi"
                    type="range"
                    min="${this.minYear}"
                    max="${this.maxYear}"
                    step="1"
                    value="${this.maxYear}"
                    class="timeCtrlSlider"
                />
                <output id="yearOutputMaxi">0000</output>
            </div>
            `,this.yearSliderMaxi=e.querySelector("#yearSliderMaxi"),t.appendChild(e),L.DomUtil.create("div"));function a(t){t.stopPropagation()}return i.innerHTML=`
                <div class="timeCtrlRadio">
                    <label>
                    <input type="radio" id="timeCtrlViewE" name="timeCtrlView" value="exact"  />
                    Exact
                    </label>
                    <label>
                    <input type="radio" id="timeCtrlViewC" name="timeCtrlView" value="intervale" checked />
                    Interval
                    </label>
                </div>
                `,t.appendChild(i),t.querySelector("#timeCtrlViewE").addEventListener("click",t=>{this._updateCircles()}),t.querySelector("#timeCtrlViewC").addEventListener("click",t=>{this._updateCircles()}),t.addEventListener("mousedown",a),t.addEventListener("click",a),t.addEventListener("dblclick",a),this.yearSliderMini.addEventListener("input",t=>{this._updateCircles()}),this.yearSliderMaxi.addEventListener("input",t=>{this._updateCircles()}),t},this._map?this.timeControl.addTo(this._map):console.warn("La carte Leaflet (_map) n'est pas dÃ©finie.")},_updateUi:function(){document.querySelector("#yearLabel").innerText=this.count,document.querySelector("#yearOutputMini").innerText=this.yearSliderMini.value,document.querySelector("#yearOutputMaxi").innerText=this.yearSliderMaxi.value,"exact"==document.querySelector('input[name="timeCtrlView"]:checked').value?document.querySelector("#yearMaxi").style.display="none":document.querySelector("#yearMaxi").style.display="grid"},_updateCircles:function(){let e=document.querySelector('input[name="timeCtrlView"]:checked').value;console.table(this._opt.data),this.count=0,this.circleData.forEach(t=>{var i=t.circle,t=t.data;"exact"===e?t[this._opt.data.year]==this.yearSliderMini.value?(this.count++,map.addLayer(i)):map.removeLayer(i):t[this._opt.data.year]>=this.yearSliderMini.value&&t[this._opt.data.year]<=this.yearSliderMaxi.value?(this.count++,map.addLayer(i)):map.removeLayer(i)}),this._updateUi()}}),L.timeCtrl=function(t,i={}){return new L.TimeCtrl(t,i)};